<!DOCTYPE html>
<html>
<head>
  <title>Beacon - WebSocket Test</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f5f5f5; }
    .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    input { padding: 8px; width: 280px; margin: 5px 0; }
    button { padding: 8px 15px; margin-left: 5px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
    button:hover { background: #0056b3; }
    #messages { border: 1px solid #ddd; height: 300px; overflow-y: auto; padding: 10px; margin-top: 10px; background: #f9f9f9; border-radius: 4px; }
    .msg { padding: 8px; margin: 5px 0; background: white; border-left: 3px solid #007bff; border-radius: 3px; }
    .success { border-left-color: #28a745; }
    .error { border-left-color: #dc3545; }
    .notification { border-left-color: #ffc107; }
    .sent { border-left-color: #17a2b8; }
    h1 { color: #333; }
    .section { margin: 20px 0; padding: 15px; background: #f0f8ff; border-radius: 4px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîî Beacon - Teste de Notifica√ß√µes RT</h1>
    
    <div class="section">
      <h3>Sua Room:</h3>
      <input type="text" id="room" placeholder="Digite o nome da sala" value="usuarios">
      <button onclick="entrarNaSala()">Entrar na Sala</button>
    </div>

    <div class="section">
      <h3>Broadcast (Todos na sala):</h3>
      <input type="text" id="message" placeholder="Digite a mensagem">
      <button onclick="enviarNotificacao()">Enviar Notifica√ß√£o</button>
    </div>

    <div class="section">
      <h3>Notifica√ß√£o Privada (Um usu√°rio):</h3>
      <input type="text" id="userId" placeholder="ID do usu√°rio">
      <input type="text" id="privateMessage" placeholder="Mensagem privada">
      <button onclick="enviarPrivado()">Enviar Privado</button>
    </div>

    <h3>üì® Log de Mensagens:</h3>
    <div id="messages"></div>
  </div>

  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script>
    const socket = io('http://localhost:3000');

    socket.on('connect', () => {
      addMessage(`‚úÖ Conectado! ID: ${socket.id}`, 'success');
    });

    socket.on('notification', (data) => {
      addMessage(`üì¨ Notifica√ß√£o: ${data.message}`, 'notification');
    });

    socket.on('privateNotification', (data) => {
      addMessage(`üìß Privado: ${data.message}`, 'notification');
    });

    socket.on('userJoined', (data) => {
      addMessage(`üë§ ${data.message}`, 'success');
    });

    socket.on('disconnect', () => {
      addMessage('‚ùå Desconectado!', 'error');
    });

    function entrarNaSala() {
      const room = document.getElementById('room').value;
      socket.emit('joinRoom', room);
      addMessage(`‚úÖ Voc√™ entrou na sala: ${room}`, 'success');
    }

    function enviarNotificacao() {
      const room = document.getElementById('room').value;
      const message = document.getElementById('message').value;
      if (!message) return alert('Digite uma mensagem!');
      
      socket.emit('notifyRoom', { room, message });
      document.getElementById('message').value = '';
      addMessage(`‚Üí Broadcast: ${message}`, 'sent');
    }

    function enviarPrivado() {
      const userId = document.getElementById('userId').value;
      const message = document.getElementById('privateMessage').value;
      if (!userId || !message) return alert('Preencha ID e mensagem!');
      
      socket.emit('notifyUser', { userId, message });
      document.getElementById('privateMessage').value = '';
      addMessage(`‚Üí Privado pra ${userId}: ${message}`, 'sent');
    }

    function addMessage(text, type = 'normal') {
      const div = document.createElement('div');
      div.className = 'msg ' + type;
      div.textContent = `[${new Date().toLocaleTimeString()}] ${text}`;
      document.getElementById('messages').appendChild(div);
      document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
    }
  </script>
</body>
</html>
```

---

## üß™ Como Testar o Checkpoint 2

### **Teste 1: Broadcast (2 abas)**
1. Aba 1: Entra na sala "usuarios"
2. Aba 2: Entra na sala "usuarios"
3. Aba 1: Envia notifica√ß√£o
4. ‚úÖ Aba 2 recebe (broadcast funcionando!)

### **Teste 2: Notifica√ß√£o Privada**
1. Copia o ID de um cliente (vem no `connect`)
2. Outra aba envia notifica√ß√£o privada pra esse ID
3. ‚úÖ S√≥ esse cliente recebe

---

## üìã Checklist Checkpoint 2:

- [ ] Atualizou `events.gateway.ts`
- [ ] Atualizou `test.html`
- [ ] Roda o servidor: `npm run start:dev`
- [ ] Abre 2 abas do navegador com `test.html`
- [ ] Ambas entram na mesma sala
- [ ] Uma envia, a outra recebe ‚úÖ
- [ ] Testa notifica√ß√£o privada tamb√©m

---

## üöÄ Pr√≥ximos Checkpoints (Vis√£o Geral):
```
‚úÖ Checkpoint 1: WebSocket b√°sico (COMPLETO)
‚Üí Checkpoint 2: Broadcast (AGORA - voc√™ t√° aqui)
‚Üí Checkpoint 3: Persist√™ncia no BD (depois)
‚Üí Checkpoint 4: Bull Queue (background jobs)
‚Üí Checkpoint 5: Redis Multi-inst√¢ncia